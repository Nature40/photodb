(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"6a29":function(e,t,i){"use strict";i("b5e3")},"9dec":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;return t("q-page",{staticClass:"fit column items-center"},[void 0===e.projects?t("div",[e._v("\n    loading projects\n  ")]):t("q-select",{staticStyle:{"min-width":"200px"},attrs:{rounded:"",outlined:"","bottom-slots":"",options:e.projects,label:"Project",dense:"","options-dense":"","options-selected-class":"text-deep-blue",title:"Select one project of images."},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"menu_book"}})]},proxy:!0},{key:"option",fn:function(i){return[t("q-item",e._g(e._b({},"q-item",i.itemProps,!1),i.itemEvents),[e._v("\n        "+e._s(i.opt)+"\n      ")])]}},{key:"selected-item",fn:function(t){return[e._v("\n      "+e._s(t.opt)+"\n    ")]}}]),model:{value:e.selectedProject,callback:function(t){e.selectedProject=t},expression:"selectedProject"}}),void 0===e.project?t("div",[e._v("\n    no project selected\n  ")]):void 0===e.meta||e.meta.project!==e.project?t("div",[e._v("\n    loading project...\n  ")]):e._e(),t("div",{staticClass:"column items-center"},[t("q-btn-toggle",{attrs:{push:"",glossy:"","toggle-color":"primary",options:[{label:"Query",value:"query",icon:"manage_search"},{label:"Review List",value:"review_list",icon:"assignment"}],title:"Select working images by subset query or by image lists."},model:{value:e.selectedQueryMode,callback:function(t){e.selectedQueryMode=t},expression:"selectedQueryMode"}})],1),t("hr",{staticStyle:{"min-width":"500px"}}),"query"===e.selectedQueryMode?t("div",{staticClass:"column items-center"},[t("q-select",{staticStyle:{"min-width":"200px"},attrs:{rounded:"",outlined:"","bottom-slots":"",options:e.locations,label:"Location",dense:"","options-dense":"","options-selected-class":"text-deep-blue",title:"Select one location of images."},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"location_on"}})]},proxy:!0},{key:"option",fn:function(i){return[t("q-item",e._g(e._b({},"q-item",i.itemProps,!1),i.itemEvents),[e._v("\n          "+e._s(i.opt)+"\n        ")])]}},{key:"selected-item",fn:function(t){return[e._v("\n        "+e._s(t.opt)+"\n      ")]}}],null,!1,2011478889),model:{value:e.selectedLocation,callback:function(t){e.selectedLocation=t},expression:"selectedLocation"}}),""===e.selectedLocation?t("div",[e._v("\n      No location selected. \n      "),t("br"),t("q-icon",{attrs:{name:"info"}}),e._v(" Select a location!\n    ")],1):e._e()],1):e._e(),"review_list"===e.selectedQueryMode?t("div",{staticClass:"column items-center"},[t("div",{staticClass:"row"},[t("q-select",{staticStyle:{"min-width":"200px"},attrs:{rounded:"",outlined:"","bottom-slots":"",options:e.review_list_sets,"option-label":"name",label:"Review list set",dense:"","options-dense":"","options-selected-class":"text-deep-blue",title:"Select one set of image lists."},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"folder"}})]},proxy:!0}],null,!1,2970690682),model:{value:e.selectedReviewListSet,callback:function(t){e.selectedReviewListSet=t},expression:"selectedReviewListSet"}}),t("q-select",{staticStyle:{"min-width":"400px"},attrs:{rounded:"",outlined:"","bottom-slots":"",options:e.review_lists,label:"Review list",dense:"","options-dense":"","options-selected-class":"text-deep-blue",title:"Select one image list."},scopedSlots:e._u([{key:"prepend",fn:function(){return[t("q-icon",{attrs:{name:"playlist_play"}})]},proxy:!0},{key:"option",fn:function(i){return[t("q-item",e._g(e._b({},"q-item",i.itemProps,!1),i.itemEvents),[e._v("\n          "+e._s(i.opt.name)+"  "),t("span",{staticStyle:{color:"grey","padding-left":"10px"}},[e._v(e._s(i.opt.count))])])]}},{key:"selected-item",fn:function(t){return[e._v("\n        "+e._s(t.opt.name)+"\n      ")]}},{key:"after",fn:function(){return[t("q-btn",{attrs:{push:"",color:"grey-7",round:"",icon:"edit_note",title:"Manage image list sets."},on:{click:function(t){return e.$refs.manageReviewListSetsDialog.show()}}}),t("manage-review-list-sets-dialog",{ref:"manageReviewListSetsDialog",on:{closed:e.refreshProjectMeta,refresh:e.refreshProjectMeta}})]},proxy:!0}],null,!1,3238669986),model:{value:e.selectedReviewList,callback:function(t){e.selectedReviewList=t},expression:"selectedReviewList"}})],1),void 0===e.review_lists||null===e.review_lists||0===e.review_lists.length?t("div",[e._v("\n      No review_list found.\n    ")]):e._e()]):e._e(),t("hr",{staticStyle:{"min-width":"500px"}}),t("div",{staticClass:"column items-center"},[e._v("\n    "+e._s(e.photos.length)+" photos selected.\n  ")])],1)},o=[],a=i("2f62"),l=function(){var e=this,t=e._self._c;return t("q-dialog",{attrs:{persistent:"","full-width":e.maximized,"full-height":e.maximized},model:{value:e.shown,callback:function(t){e.shown=t},expression:"shown"}},[t("q-layout",{staticClass:"bg-white text-black",staticStyle:{"min-width":"600px"},attrs:{view:"Lhh lpR fff",container:""}},[t("q-header",{staticClass:"bg-grey-2 text-black"},[t("q-toolbar",[t("q-icon",{staticClass:"text-grey-7",staticStyle:{"font-size":"2em"},attrs:{name:"edit_note"}}),t("q-toolbar-title",[e._v("\n          Manage review list sets\n        ")]),t("q-space"),e.maximized?t("q-btn",{attrs:{dense:"",flat:"",icon:"content_copy"},on:{click:function(t){e.maximized=!1}}},[t("q-tooltip",[e._v("Shrink")])],1):e._e(),e.maximized?e._e():t("q-btn",{attrs:{dense:"",flat:"",icon:"crop_square"},on:{click:function(t){e.maximized=!0}}},[t("q-tooltip",[e._v("Maximize")])],1),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close"}},[t("q-tooltip",[e._v("Close")])],1)],1),t("q-separator")],1),t("q-footer",{staticClass:"bg-white text-black"},[t("q-separator"),t("q-toolbar",{attrs:{inset:""}},[e.loading?t("span",[t("q-spinner-gears",{attrs:{color:"primary",size:"2em"}}),e._v(" "+e._s(e.loading))],1):e._e(),e.loadingError?t("span",[e._v(" "+e._s(e.loadingError))]):e._e(),t("q-space"),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Close",disabled:e.loading}})],1)],1),t("q-page-container",[t("q-page",{attrs:{padding:""}},[t("q-btn",{attrs:{push:"",icon:"playlist_add"},on:{click:function(t){return e.$refs.createReviewListDialog.show()}}},[e._v("Add new review list set")]),t("create-review-list-dialog",{ref:"createReviewListDialog",on:{closed:function(t){return e.$emit("refresh")}}}),t("hr",{staticStyle:{"margin-bottom":"20px"}}),t("b",[e._v("Review list sets:")]),t("br"),t("br"),void 0!==e.review_list_sets&&e.review_list_sets.length>0?t("q-table",{staticClass:"my-sticky-header-column-table",attrs:{data:e.review_list_sets,columns:e.columns,"row-key":"id","rows-per-page":"0","hide-bottom":"",selection:"multiple",selected:e.selected,dense:""},on:{"update:selected":function(t){e.selected=t}}}):t("div",[t("b",[e._v("No review list sets available. You may create new review list sets!")])]),t("hr",{staticStyle:{"margin-bottom":"20px"}}),t("b",[e._v("Actions for selected sets:")]),t("br"),t("q-btn",{staticStyle:{"margin-top":"20px"},attrs:{push:"",icon:"refresh",disabled:e.selectedEmpty,"text-color":"green",title:"Refresh creation of image sets with current images and current meta data."},on:{click:e.onRefreshSets}},[e._v("\n          regenerate lists of selected sets\n        ")]),t("br"),t("q-btn",{staticStyle:{"margin-top":"20px"},attrs:{push:"",icon:"delete_forever",disabled:e.selectedEmpty,"text-color":"red",title:"Delete image sets. Contained images are not deleted."},on:{click:e.onRemove}},[e._v("\n          remove selected sets\n        ")])],1)],1)],1)],1)},n=[],r=function(){var e=this,t=e._self._c;return t("q-dialog",{attrs:{persistent:"","full-width":e.maximized,"full-height":e.maximized},model:{value:e.shown,callback:function(t){e.shown=t},expression:"shown"}},[t("q-layout",{staticClass:"bg-white text-black",attrs:{view:"Lhh lpR fff",container:""}},[t("q-header",{staticClass:"bg-grey-2 text-black"},[t("q-toolbar",[t("q-icon",{staticClass:"text-grey-7",staticStyle:{"font-size":"2em"},attrs:{name:"playlist_add"}}),t("q-toolbar-title",[e._v("\n          Create review list set\n        ")]),t("q-space"),e.maximized?t("q-btn",{attrs:{dense:"",flat:"",icon:"content_copy"},on:{click:function(t){e.maximized=!1}}},[t("q-tooltip",[e._v("Shrink")])],1):e._e(),e.maximized?e._e():t("q-btn",{attrs:{dense:"",flat:"",icon:"crop_square"},on:{click:function(t){e.maximized=!0}}},[t("q-tooltip",[e._v("Maximize")])],1),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",flat:"",icon:"close"}},[t("q-tooltip",[e._v("Close")])],1)],1),t("q-separator")],1),t("q-footer",{staticClass:"bg-white text-black"},[t("q-separator"),t("q-toolbar",{attrs:{inset:""}},[e.loading?t("span",[t("q-spinner-gears",{attrs:{color:"primary",size:"2em"}}),e._v(" "+e._s(e.loading))],1):e._e(),e.loadingError?t("span",[e._v(" "+e._s(e.loadingError))]):e._e(),t("q-space"),t("q-btn",{staticClass:"text-teal",attrs:{flat:"",label:"Create",disabled:e.loading,title:"Create your specified image list set. This may take some time."},on:{click:e.onSubmitCreateReviewList}}),t("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",disabled:e.loading,title:"Discard creating image list set."}})],1)],1),t("q-page-container",[t("q-page",{attrs:{padding:""}},[t("b",[e._v("Name")]),t("q-input",{attrs:{label:"Review list set name",placeholder:"automatic generated set name","stack-label":"",dense:"","bottom-slots":""},scopedSlots:e._u([{key:"hint",fn:function(){return[e._v("\n            (For existing set name, old set will be overwritten.)\n          ")]},proxy:!0}]),model:{value:e.set_name,callback:function(t){e.set_name=t},expression:"set_name"}}),t("hr",{staticStyle:{"margin-bottom":"20px"}}),t("b",[e._v("Prefilter")]),t("span",{staticClass:"row"},[t("q-input",{attrs:{outlined:"",label:"Prefilter classificator","stack-label":"",dense:"",title:"Name of classificator."},model:{value:e.prefilter_classificator,callback:function(t){e.prefilter_classificator=t},expression:"prefilter_classificator"}}),e.prefilter_classificator?t("q-input",{attrs:{outlined:"",label:"Prefilter confidence threshold","stack-label":"",dense:"",type:"number",min:"0",max:"1",step:".1",title:"Discard confidence values lower than this number between 0 and 1."},model:{value:e.prefilter_threshold,callback:function(t){e.prefilter_threshold=t},expression:"prefilter_threshold"}}):e._e(),e.prefilter_classificator&&!e.prefilter_threshold?t("span",[e._v("(no threshold)")]):e._e(),e.prefilter_classificator?e._e():t("span",[e._v("(not applied)")])],1),t("hr",{staticStyle:{"margin-bottom":"20px"}}),t("b",[e._v("Classification filter")]),t("span",{staticClass:"row"},[t("q-input",{attrs:{outlined:"",label:"Classification classificator","stack-label":"",dense:"",title:"Name of classificator."},model:{value:e.classification_classificator,callback:function(t){e.classification_classificator=t},expression:"classification_classificator"}}),e.classification_classificator?t("q-input",{attrs:{outlined:"",label:"Classification confidence threshold","stack-label":"",dense:"",type:"number",min:"0",max:"1",step:".1",title:"Discard confidence values lower than this number between 0 and 1."},model:{value:e.classification_threshold,callback:function(t){e.classification_threshold=t},expression:"classification_threshold"}}):e._e(),e.classification_classificator&&!e.classification_threshold?t("span",[e._v("(no threshold)")]):e._e(),e.classification_classificator?e._e():t("span",[e._v("(not applied)")])],1),t("hr",{staticStyle:{"margin-bottom":"20px"}}),t("b",[e._v("Groups")]),t("br"),t("q-select",{attrs:{label:"Group into review lists by",options:e.groupByOptions,outlined:"","stack-label":"",dense:"","options-dense":"",title:"The Classification of selected classification filter is used."},model:{value:e.groupByOption,callback:function(t){e.groupByOption=t},expression:"groupByOption"}}),t("hr",{staticStyle:{"margin-bottom":"20px"}}),t("b",[e._v("Options")]),t("br"),t("q-checkbox",{attrs:{label:"Unreviewed images only (Omit images with expert classifications.)",dense:"",title:"Images with at least one expert classification are not included in resulting lists. With this option, images that are not already reviewed by experts are listed only."},model:{value:e.omit_expert_classified,callback:function(t){e.omit_expert_classified=t},expression:"omit_expert_classified"}}),t("br"),t("q-checkbox",{staticStyle:{"padding-top":"10px"},attrs:{label:"Sort by classification confidence",dense:"",title:"The Classification of selected classification filter is used."},model:{value:e.sorted_by_ranking,callback:function(t){e.sorted_by_ranking=t},expression:"sorted_by_ranking"}})],1)],1)],1)],1)},c=[],d={name:"create-review-list-dialog",data:()=>({shown:!1,maximized:!1,set_name:void 0,prefilter_classificator:"MegaDetector",prefilter_threshold:.8,classification_classificator:"EfficientNetB3",classification_threshold:.8,sorted_by_ranking:!0,loading:void 0,loadingError:void 0,groupByOptions:[{label:"classification",value:"classification"},{label:"location",value:"location"},{label:"classification and location",value:"classification_location"},{label:"location and classification",value:"location_classification"}],groupByOption:void 0,omit_expert_classified:!1}),computed:{...Object(a["d"])({project:e=>e.project}),...Object(a["c"])({apiPOST:"apiPOST"})},watch:{shown(){this.shown||this.$emit("closed")}},methods:{...Object(a["b"])({}),show(){this.shown=!0},async onSubmitCreateReviewList(){var e={action:"create_review_list_set"};void 0!==this.set_name&&null!==this.set_name&&this.set_name.length>0&&(e.set_name=this.set_name),this.prefilter_classificator&&(e.prefilter_classificator=this.prefilter_classificator,this.prefilter_threshold&&(e.prefilter_threshold=this.prefilter_threshold)),this.classification_classificator&&(e.classification_classificator=this.classification_classificator,this.classification_threshold&&(e.classification_threshold=this.classification_threshold)),this.groupByOption&&(e.group_by=this.groupByOption.value),e.sorted_by_ranking=this.sorted_by_ranking,e.omit_expert_classified=this.omit_expert_classified;var t={actions:[e]};let i={project:this.project};try{this.loading="Processing",this.loadingError=void 0;await this.apiPOST(["photodb2","review_lists"],t,{params:i});this.loading=void 0,this.loadingError=void 0,this.shown=!1}catch{this.loading=void 0,this.loadingError="Proccessing error",console.log("error")}}},async mounted(){this.groupByOption=this.groupByOptions[0]}},p=d,h=i("2877"),u=i("24e8"),v=i("4d5a"),m=i("e359"),_=i("65c6"),f=i("0016"),b=i("6ac5"),g=i("2c91"),w=i("9c40"),y=i("05c0"),x=i("eb85"),q=i("7ff0"),k=i("cf57"),j=i("09e3"),S=i("9989"),Q=i("27f9"),P=i("ddd8"),L=i("8f8e"),C=i("7f67"),R=i("eebe"),O=i.n(R),T=Object(h["a"])(p,r,c,!1,null,"0197b4b8",null),E=T.exports;O()(T,"components",{QDialog:u["a"],QLayout:v["a"],QHeader:m["a"],QToolbar:_["a"],QIcon:f["a"],QToolbarTitle:b["a"],QSpace:g["a"],QBtn:w["a"],QTooltip:y["a"],QSeparator:x["a"],QFooter:q["a"],QSpinnerGears:k["a"],QPageContainer:j["a"],QPage:S["a"],QInput:Q["a"],QSelect:P["a"],QCheckbox:L["a"]}),O()(T,"directives",{ClosePopup:C["a"]});var z={name:"manage-review-list-sets-dialog",components:{createReviewListDialog:E},data:()=>({shown:!1,maximized:!1,set_name:void 0,prefilter_classificator:"MegaDetector",prefilter_threshold:.8,classification_classificator:"EfficientNetB3",classification_threshold:.8,sorted_by_ranking:!0,loading:void 0,loadingError:void 0,columns:[{label:"Project",field:"project",name:"project",align:"center",sortable:!0},{label:"Name",field:"name",name:"name",align:"center",sortable:!0}],selected:[]}),computed:{...Object(a["d"])({project:e=>e.project,review_list_sets:e=>{var t,i;return null===(t=e.meta)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.review_list_sets}}),...Object(a["c"])({apiPOST:"apiPOST"}),selectedEmpty(){return void 0===this.selected||0===this.selected.length}},watch:{shown(){this.shown||this.$emit("closed")},review_list_sets(){this.selected=[]}},methods:{...Object(a["b"])({}),show(){this.selected=[],this.shown=!0},async onRefreshSets(){var e={action:"refresh_review_list_set"};e.sets=this.selected.map((e=>e.id));var t={actions:[e]};let i={project:this.project};try{this.loading="Processing",this.loadingError=void 0;await this.apiPOST(["photodb2","review_lists"],t,{params:i});this.loading=void 0,this.loadingError=void 0}catch{this.loading=void 0,this.loadingError="Proccessing error",console.log("error")}finally{this.selected=[],this.$emit("refresh")}},async onRemove(){var e={action:"remove_review_list_set"};e.sets=this.selected.map((e=>e.id));var t={actions:[e]};let i={project:this.project};try{this.loading="Processing",this.loadingError=void 0;await this.apiPOST(["photodb2","review_lists"],t,{params:i});this.loading=void 0,this.loadingError=void 0}catch{this.loading=void 0,this.loadingError="Proccessing error",console.log("error")}finally{this.selected=[],this.$emit("refresh")}}},async mounted(){}},M=z,B=i("eaac"),D=Object(h["a"])(M,l,n,!1,null,"08ae8454",null),$=D.exports;O()(D,"components",{QDialog:u["a"],QLayout:v["a"],QHeader:m["a"],QToolbar:_["a"],QIcon:f["a"],QToolbarTitle:b["a"],QSpace:g["a"],QBtn:w["a"],QTooltip:y["a"],QSeparator:x["a"],QFooter:q["a"],QSpinnerGears:k["a"],QPageContainer:j["a"],QPage:S["a"],QTable:B["a"]}),O()(D,"directives",{ClosePopup:C["a"]});const N=function(e,t){const i=e.name.toUpperCase(),s=t.name.toUpperCase();return i<s?-1:i>s?1:0};var I={name:"query",components:{manageReviewListSetsDialog:$},data:()=>({photosMessage:"init",selectedProject:void 0,selectedLocation:"",selectedQueryMode:"query",selectedReviewListSet:void 0,selectedReviewList:void 0}),computed:{...Object(a["d"])({project:e=>e.project,photos:e=>e.photos.data,photoIndex:e=>e.photo.index,projects:e=>{var t,i;return null===(t=e.projects)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.projects},meta:e=>{var t;return null===(t=e.meta)||void 0===t?void 0:t.data},locations:e=>{var t,i;return null===(t=e.meta)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.locations},review_lists_unfiltered:e=>{var t,i;return null===(t=e.meta)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.review_lists},review_list_sets:e=>{var t,i;return null===(t=e.meta)||void 0===t||null===(i=t.data)||void 0===i?void 0:i.review_list_sets}}),...Object(a["c"])({api:"api",apiGET:"apiGET"}),review_lists(){return void 0===this.review_lists_unfiltered?[]:void 0===this.selectedReviewListSet?this.review_lists_unfiltered.slice().sort(N):this.review_lists_unfiltered.filter((e=>e.set===this.selectedReviewListSet.id)).sort(N)}},watch:{projects(){console.log(this.projects),void 0===this.projects||0===this.projects.length?this.selectedProject=void 0:void 0===this.selectedProject&&(this.selectedProject=this.projects[0])},async selectedProject(){this.refreshProjectMeta()},locations(){void 0===this.locations||0===this.locations.length?this.selectedLocation="":this.selectedLocation=this.locations[0]},selectedLocation(){this.$nextTick((()=>this.sendQuery()))},selectedReviewList(){this.$nextTick((()=>this.sendQuery()))},selectedQueryMode(){this.$nextTick((()=>this.sendQuery()))},review_lists(){void 0===this.review_lists||0===this.review_lists.length?this.selectedReviewList=void 0:this.selectedReviewList=this.review_lists[0]},review_list_sets(){void 0===this.review_list_sets||0===this.review_list_sets.length?this.selectedReviewListSet=void 0:this.selectedReviewListSet=this.review_list_sets[0]}},methods:{...Object(a["b"])({metaQuery:"meta/query",photosQuery:"photos/query",photoSetIndex:"photo/setIndex"}),setIndex(e){this.photoSetIndex(e),this.$router.push("/viewer")},sendQuery(){"query"===this.selectedQueryMode?void 0!==this.selectedProject&&void 0!==this.selectedLocation&&null!==this.selectedLocation&&""!==this.selectedLocation?this.photosQuery({project:this.selectedProject,location:this.selectedLocation}):this.photosQuery():"review_list"===this.selectedQueryMode&&(void 0!==this.selectedProject&&void 0!==this.selectedReviewList&&null!==this.selectedReviewList?this.photosQuery({project:this.selectedProject,review_list:this.selectedReviewList.id}):this.photosQuery())},async refreshProjectMeta(){await this.$store.dispatch("setProject",this.selectedProject),this.$nextTick((()=>this.sendQuery()))}},async mounted(){this.$store.dispatch("projects/init")}},G=I,F=(i("6a29"),i("66e5")),U=i("6a67"),A=Object(h["a"])(G,s,o,!1,null,"160ac97b",null);t["default"]=A.exports;O()(A,"components",{QPage:S["a"],QSelect:P["a"],QIcon:f["a"],QItem:F["a"],QBtnToggle:U["a"],QBtn:w["a"]})},b5e3:function(e,t,i){}}]);